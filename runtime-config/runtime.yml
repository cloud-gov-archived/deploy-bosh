releases:
- {name: fisma, version: ((release_version.fisma))}
- {name: aide, version: ((release_version.aide))}
- {name: clamav, version: ((release_version.clamav))}
- {name: snort, version: ((release_version.snort))}
- {name: awslogs, version: ((release_version.awslogs))}
# - {name: nessus-agent, version: ((release_nessus_agent))}
# - {name: node-exporter, version: ((release_node_exporter))}
# - {name: syslog, version: ((release_syslog))}

addons:
# - include:
    # stemcell:
    # - os: ubuntu-jammy
- name: hardening-jammy
  jobs:
  - name: snort
    release: snort
  - name: clamav
    release: clamav
    properties:
      clamav:
        dbMirror1: ((/clamav.mirror))
        alert_on_stale_defs: ((/clamav.alert_on_stale_defs))
        schedule_enabled: ((/clamav.schedule_enabled))
        on_access_enabled: ((/clamav.onaccess_enabled))
        cron:
          schedule: ((/clamav.cron_schedule))
        include_directories: ((/clamav.include_directories))
        exclude_directories: ((/clamav.exclude_directories))
  # - name: syslog_forwarder
  #   properties:
  #     syslog:
  #       address: ((terraform_outputs.platform_syslog_elb_dns_name))
  #       port: 5514
  #   release: syslog
  - name: aide
    release: aide
  - name: harden
    release: fisma
  # - name: node_exporter
  #   release: node-exporter
  # - name: nessus-agent
  #   release: nessus-agent
  #   properties:
  #     nessus-agent:
  #       key: ((/nessus_agent_key))
  #       group: ((/nessus_agent_group))
  #       server: ((terraform_outputs.nessus_static_ip))
  #       port: 8834
  - name: awslogs
    release: awslogs
    properties:
      awslogs:
        region: ((/aws.region))
        awslogs_files_config:
        - name: /var/log/audit/audit.log
          file: /var/log/audit/audit.log
          log_group_name: /var/log/audit/audit.log
          log_stream_name: "{{instance_id}}"
          initial_position: start_of_file
          datetime_format: "%Y-%m-%dT%H:%M:%S"
        - name: /var/log/auth.log
          file: /var/log/auth.log
          log_group_name: /var/log/auth.log
          log_stream_name: "{{instance_id}}"
          initial_position: start_of_file
          datetime_format: "%Y-%m-%dT%H:%M:%S"
        - name: /var/log/dpkg.log
          file: /var/log/dpkg.log
          log_group_name: /var/log/dpkg.log
          log_stream_name: "{{instance_id}}"
          initial_position: start_of_file
          datetime_format: "%Y-%m-%dT%H:%M:%S"
        - name: /var/log/syslog
          file: /var/log/syslog
          log_group_name: /var/log/syslog
          log_stream_name: "{{instance_id}}"
          initial_position: start_of_file
          datetime_format: "%Y-%m-%dT%H:%M:%S"
tags:
  environment: ((/bosh_director.ip))
# variables:
# - name: nessus_agent_key
#   type: password
# - name: nessus_agent_group
#   type: password
